{"ast":null,"code":"import { h, ref, isRef, computed, watch, provide, onBeforeUnmount, getCurrentInstance } from 'vue';\nimport QBtn from '../btn/QBtn.js';\nimport QIcon from '../icon/QIcon.js';\nimport QSpinner from '../spinner/QSpinner.js';\nimport QCircularProgress from '../circular-progress/QCircularProgress.js';\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js';\nimport useFile, { useFileProps, useFileEmits } from '../../composables/private/use-file.js';\nimport { stop } from '../../utils/event.js';\nimport { humanStorageSize } from '../../utils/format.js';\nimport { uploaderKey } from '../../utils/private/symbols.js';\n\nfunction getProgressLabel(p) {\n  return (p * 100).toFixed(2) + '%';\n}\n\nexport const coreProps = { ...useDarkProps,\n  ...useFileProps,\n  label: String,\n  color: String,\n  textColor: String,\n  square: Boolean,\n  flat: Boolean,\n  bordered: Boolean,\n  noThumbnails: Boolean,\n  autoUpload: Boolean,\n  hideUploadBtn: Boolean,\n  disable: Boolean,\n  readonly: Boolean\n};\nexport const coreEmits = [...useFileEmits, 'start', 'finish', 'added', 'removed'];\nexport function getRenderer(getPlugin) {\n  const vm = getCurrentInstance();\n  const {\n    props,\n    slots,\n    emit,\n    proxy\n  } = vm;\n  const {\n    $q\n  } = proxy;\n  const isDark = useDark(props, $q);\n\n  function updateFileStatus(file, status, uploadedSize) {\n    file.__status = status;\n\n    if (status === 'idle') {\n      file.__uploaded = 0;\n      file.__progress = 0;\n      file.__sizeLabel = humanStorageSize(file.size);\n      file.__progressLabel = '0.00%';\n      return;\n    }\n\n    if (status === 'failed') {\n      proxy.$forceUpdate();\n      return;\n    }\n\n    file.__uploaded = status === 'uploaded' ? file.size : uploadedSize;\n    file.__progress = status === 'uploaded' ? 1 : Math.min(0.9999, file.__uploaded / file.size);\n    file.__progressLabel = getProgressLabel(file.__progress);\n    proxy.$forceUpdate();\n  }\n\n  const state = {\n    files: ref([]),\n    queuedFiles: ref([]),\n    uploadedFiles: ref([]),\n    uploadedSize: ref(0),\n    updateFileStatus,\n\n    isAlive() {\n      return vm.isDeactivated !== true && vm.isUnmounted !== true;\n    }\n\n  };\n  Object.assign(state, getPlugin({\n    props,\n    slots,\n    emit,\n    helpers: state\n  }));\n  const uploadSize = ref(0);\n  const editable = computed(() => props.disable !== true && props.readonly !== true);\n\n  if (state.isBusy === void 0) {\n    state.isBusy = ref(false);\n  }\n\n  const dnd = ref(false);\n  const rootRef = ref(null);\n  const inputRef = ref(null);\n  provide(uploaderKey, renderInput);\n  const {\n    pickFiles,\n    addFiles,\n    onDragover,\n    onDragleave,\n    processFiles,\n    getDndNode,\n    maxFilesNumber,\n    maxTotalSizeNumber\n  } = useFile({\n    editable,\n    dnd,\n    getFileInput,\n    addFilesToQueue\n  });\n  const canAddFiles = computed(() => editable.value === true && state.isUploading.value !== true // if single selection and no files are queued:\n  && (props.multiple === true || state.queuedFiles.value.length === 0) // if max-files is set and current number of files does not exceeds it:\n  && (props.maxFiles === void 0 || state.files.value.length < maxFilesNumber.value) // if max-total-size is set and current upload size does not exceeds it:\n  && (props.maxTotalSize === void 0 || uploadSize.value < maxTotalSizeNumber.value));\n  const canUpload = computed(() => editable.value === true && state.isBusy.value !== true && state.isUploading.value !== true && state.queuedFiles.value.length > 0);\n  const uploadProgress = computed(() => uploadSize.value === 0 ? 0 : state.uploadedSize.value / uploadSize.value);\n  const uploadProgressLabel = computed(() => getProgressLabel(uploadProgress.value));\n  const uploadSizeLabel = computed(() => humanStorageSize(uploadSize.value));\n  const classes = computed(() => 'q-uploader column no-wrap' + (isDark.value === true ? ' q-uploader--dark q-dark' : '') + (props.bordered === true ? ' q-uploader--bordered' : '') + (props.square === true ? ' q-uploader--square no-border-radius' : '') + (props.flat === true ? ' q-uploader--flat no-shadow' : '') + (props.disable === true ? ' disabled q-uploader--disable' : ''));\n  const colorClass = computed(() => 'q-uploader__header' + (props.color !== void 0 ? ` bg-${props.color}` : '') + (props.textColor !== void 0 ? ` text-${props.textColor}` : ''));\n  watch(state.isUploading, (newVal, oldVal) => {\n    if (oldVal === false && newVal === true) {\n      emit('start');\n    } else if (oldVal === true && newVal === false) {\n      emit('finish');\n    }\n  });\n\n  function reset() {\n    if (props.disable === false) {\n      state.abort();\n      state.uploadedSize.value = 0;\n      uploadSize.value = 0;\n      revokeImgURLs();\n      state.files.value = [];\n      state.queuedFiles.value = [];\n      state.uploadedFiles.value = [];\n    }\n  }\n\n  function removeUploadedFiles() {\n    if (props.disable === false) {\n      batchRemoveFiles(['uploaded'], () => {\n        state.uploadedFiles.value = [];\n      });\n    }\n  }\n\n  function removeQueuedFiles() {\n    batchRemoveFiles(['idle', 'failed'], ({\n      size\n    }) => {\n      uploadSize.value -= size;\n      state.queuedFiles.value = [];\n    });\n  }\n\n  function batchRemoveFiles(statusList, cb) {\n    if (props.disable === true) {\n      return;\n    }\n\n    const removed = {\n      files: [],\n      size: 0\n    };\n    const localFiles = state.files.value.filter(f => {\n      if (statusList.indexOf(f.__status) === -1) {\n        return true;\n      }\n\n      removed.size += f.size;\n      removed.files.push(f);\n      f.__img !== void 0 && window.URL.revokeObjectURL(f.__img.src);\n      return false;\n    });\n\n    if (removed.files.length > 0) {\n      state.files.value = localFiles;\n      cb(removed);\n      emit('removed', removed.files);\n    }\n  }\n\n  function removeFile(file) {\n    if (props.disable) {\n      return;\n    }\n\n    if (file.__status === 'uploaded') {\n      state.uploadedFiles.value = state.uploadedFiles.value.filter(f => f.__key !== file.__key);\n    } else if (file.__status === 'uploading') {\n      file.__abort();\n    } else {\n      uploadSize.value -= file.size;\n    }\n\n    state.files.value = state.files.value.filter(f => {\n      if (f.__key !== file.__key) {\n        return true;\n      }\n\n      f.__img !== void 0 && window.URL.revokeObjectURL(f.__img.src);\n      return false;\n    });\n    state.queuedFiles.value = state.queuedFiles.value.filter(f => f.__key !== file.__key);\n    emit('removed', [file]);\n  }\n\n  function revokeImgURLs() {\n    state.files.value.forEach(f => {\n      f.__img !== void 0 && window.URL.revokeObjectURL(f.__img.src);\n    });\n  }\n\n  function getFileInput() {\n    return inputRef.value || rootRef.value.getElementsByClassName('q-uploader__input')[0];\n  }\n\n  function addFilesToQueue(e, fileList) {\n    const localFiles = processFiles(e, fileList, state.files.value, true);\n\n    if (localFiles === void 0) {\n      return;\n    }\n\n    const fileInput = getFileInput();\n\n    if (fileInput !== void 0 && fileInput !== null) {\n      fileInput.value = '';\n    }\n\n    localFiles.forEach(file => {\n      state.updateFileStatus(file, 'idle');\n      uploadSize.value += file.size;\n\n      if (props.noThumbnails !== true && file.type.toUpperCase().startsWith('IMAGE')) {\n        const img = new Image();\n        img.src = window.URL.createObjectURL(file);\n        file.__img = img;\n      }\n    });\n    state.files.value = state.files.value.concat(localFiles);\n    state.queuedFiles.value = state.queuedFiles.value.concat(localFiles);\n    emit('added', localFiles);\n    props.autoUpload === true && state.upload();\n  }\n\n  function upload() {\n    canUpload.value === true && state.upload();\n  }\n\n  function getBtn(show, icon, fn) {\n    if (show === true) {\n      const data = {\n        type: 'a',\n        key: icon,\n        icon: $q.iconSet.uploader[icon],\n        flat: true,\n        dense: true\n      };\n      let child = void 0;\n\n      if (icon === 'add') {\n        data.onClick = pickFiles;\n        child = renderInput;\n      } else {\n        data.onClick = fn;\n      }\n\n      return h(QBtn, data, child);\n    }\n  }\n\n  function renderInput() {\n    return h('input', {\n      ref: inputRef,\n      class: 'q-uploader__input overflow-hidden absolute-full',\n      tabindex: -1,\n      type: 'file',\n      title: '',\n      // try to remove default tooltip\n      accept: props.accept,\n      multiple: props.multiple === true ? 'multiple' : void 0,\n      capture: props.capture,\n      onMousedown: stop,\n      // need to stop refocus from QBtn\n      onClick: pickFiles,\n      onChange: addFilesToQueue\n    });\n  }\n\n  function getHeader() {\n    if (slots.header !== void 0) {\n      return slots.header(slotScope.value);\n    }\n\n    return [h('div', {\n      class: 'q-uploader__header-content column'\n    }, [h('div', {\n      class: 'flex flex-center no-wrap q-gutter-xs'\n    }, [getBtn(state.queuedFiles.value.length > 0, 'removeQueue', removeQueuedFiles), getBtn(state.uploadedFiles.value.length > 0, 'removeUploaded', removeUploadedFiles), state.isUploading.value === true ? h(QSpinner, {\n      class: 'q-uploader__spinner'\n    }) : null, h('div', {\n      class: 'col column justify-center'\n    }, [props.label !== void 0 ? h('div', {\n      class: 'q-uploader__title'\n    }, [props.label]) : null, h('div', {\n      class: 'q-uploader__subtitle'\n    }, [uploadSizeLabel.value + ' / ' + uploadProgressLabel.value])]), getBtn(canAddFiles.value, 'add'), getBtn(props.hideUploadBtn === false && canUpload.value === true, 'upload', state.upload), getBtn(state.isUploading.value, 'clear', state.abort)])])];\n  }\n\n  function getList() {\n    if (slots.list !== void 0) {\n      return slots.list(slotScope.value);\n    }\n\n    return state.files.value.map(file => h('div', {\n      key: file.__key,\n      class: 'q-uploader__file relative-position' + (props.noThumbnails !== true && file.__img !== void 0 ? ' q-uploader__file--img' : '') + (file.__status === 'failed' ? ' q-uploader__file--failed' : file.__status === 'uploaded' ? ' q-uploader__file--uploaded' : ''),\n      style: props.noThumbnails !== true && file.__img !== void 0 ? {\n        backgroundImage: 'url(\"' + file.__img.src + '\")'\n      } : null\n    }, [h('div', {\n      class: 'q-uploader__file-header row flex-center no-wrap'\n    }, [file.__status === 'failed' ? h(QIcon, {\n      class: 'q-uploader__file-status',\n      name: $q.iconSet.type.negative,\n      color: 'negative'\n    }) : null, h('div', {\n      class: 'q-uploader__file-header-content col'\n    }, [h('div', {\n      class: 'q-uploader__title'\n    }, [file.name]), h('div', {\n      class: 'q-uploader__subtitle row items-center no-wrap'\n    }, [file.__sizeLabel + ' / ' + file.__progressLabel])]), file.__status === 'uploading' ? h(QCircularProgress, {\n      value: file.__progress,\n      min: 0,\n      max: 1,\n      indeterminate: file.__progress === 0\n    }) : h(QBtn, {\n      round: true,\n      dense: true,\n      flat: true,\n      icon: $q.iconSet.uploader[file.__status === 'uploaded' ? 'done' : 'clear'],\n      onClick: () => {\n        removeFile(file);\n      }\n    })])]));\n  }\n\n  onBeforeUnmount(() => {\n    state.isUploading.value === true && state.abort();\n    state.files.value.length > 0 && revokeImgURLs();\n  });\n  const publicMethods = {\n    pickFiles,\n    addFiles,\n    reset,\n    removeUploadedFiles,\n    removeQueuedFiles,\n    removeFile,\n    upload,\n    abort: state.abort\n  }; // TODO: the result of this computed, especially the dynamic part, isn't currently typed\n  // This result in an error with Volar when accessing the state (eg. files array)\n\n  const slotScope = computed(() => {\n    const acc = {\n      canAddFiles: canAddFiles.value,\n      canUpload: canUpload.value,\n      uploadSizeLabel: uploadSizeLabel.value,\n      uploadProgressLabel: uploadProgressLabel.value\n    };\n\n    for (const key in state) {\n      acc[key] = isRef(state[key]) === true ? state[key].value : state[key];\n    } // TODO: (Qv3) Put the QUploader instance under `ref`\n    // property for consistency and flexibility\n    // return { ref: { ...acc, ...publicMethods } }\n\n\n    return { ...acc,\n      ...publicMethods\n    };\n  }); // expose public methods\n\n  Object.assign(proxy, publicMethods);\n  return () => {\n    const children = [h('div', {\n      class: colorClass.value\n    }, getHeader()), h('div', {\n      class: 'q-uploader__list scroll'\n    }, getList()), getDndNode('uploader')];\n    state.isBusy.value === true && children.push(h('div', {\n      class: 'q-uploader__overlay absolute-full flex flex-center'\n    }, [h(QSpinner)]));\n    const data = {\n      ref: rootRef,\n      class: classes.value\n    };\n\n    if (canAddFiles.value === true) {\n      Object.assign(data, {\n        onDragover,\n        onDragleave\n      });\n    }\n\n    return h('div', data, children);\n  };\n}","map":{"version":3,"names":["h","ref","isRef","computed","watch","provide","onBeforeUnmount","getCurrentInstance","QBtn","QIcon","QSpinner","QCircularProgress","useDark","useDarkProps","useFile","useFileProps","useFileEmits","stop","humanStorageSize","uploaderKey","getProgressLabel","p","toFixed","coreProps","label","String","color","textColor","square","Boolean","flat","bordered","noThumbnails","autoUpload","hideUploadBtn","disable","readonly","coreEmits","getRenderer","getPlugin","vm","props","slots","emit","proxy","$q","isDark","updateFileStatus","file","status","uploadedSize","__status","__uploaded","__progress","__sizeLabel","size","__progressLabel","$forceUpdate","Math","min","state","files","queuedFiles","uploadedFiles","isAlive","isDeactivated","isUnmounted","Object","assign","helpers","uploadSize","editable","isBusy","dnd","rootRef","inputRef","renderInput","pickFiles","addFiles","onDragover","onDragleave","processFiles","getDndNode","maxFilesNumber","maxTotalSizeNumber","getFileInput","addFilesToQueue","canAddFiles","value","isUploading","multiple","length","maxFiles","maxTotalSize","canUpload","uploadProgress","uploadProgressLabel","uploadSizeLabel","classes","colorClass","newVal","oldVal","reset","abort","revokeImgURLs","removeUploadedFiles","batchRemoveFiles","removeQueuedFiles","statusList","cb","removed","localFiles","filter","f","indexOf","push","__img","window","URL","revokeObjectURL","src","removeFile","__key","__abort","forEach","getElementsByClassName","e","fileList","fileInput","type","toUpperCase","startsWith","img","Image","createObjectURL","concat","upload","getBtn","show","icon","fn","data","key","iconSet","uploader","dense","child","onClick","class","tabindex","title","accept","capture","onMousedown","onChange","getHeader","header","slotScope","getList","list","map","style","backgroundImage","name","negative","max","indeterminate","round","publicMethods","acc","children"],"sources":["C:/Users/82107/Desktop/WEB_YBR/frontend_ybr/node_modules/quasar/src/components/uploader/uploader-core.js"],"sourcesContent":["import { h, ref, isRef, computed, watch, provide, onBeforeUnmount, getCurrentInstance } from 'vue'\r\n\r\nimport QBtn from '../btn/QBtn.js'\r\nimport QIcon from '../icon/QIcon.js'\r\nimport QSpinner from '../spinner/QSpinner.js'\r\nimport QCircularProgress from '../circular-progress/QCircularProgress.js'\r\n\r\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\r\nimport useFile, { useFileProps, useFileEmits } from '../../composables/private/use-file.js'\r\n\r\nimport { stop } from '../../utils/event.js'\r\nimport { humanStorageSize } from '../../utils/format.js'\r\nimport { uploaderKey } from '../../utils/private/symbols.js'\r\n\r\nfunction getProgressLabel (p) {\r\n  return (p * 100).toFixed(2) + '%'\r\n}\r\n\r\nexport const coreProps = {\r\n  ...useDarkProps,\r\n  ...useFileProps,\r\n\r\n  label: String,\r\n\r\n  color: String,\r\n  textColor: String,\r\n\r\n  square: Boolean,\r\n  flat: Boolean,\r\n  bordered: Boolean,\r\n\r\n  noThumbnails: Boolean,\r\n  autoUpload: Boolean,\r\n  hideUploadBtn: Boolean,\r\n\r\n  disable: Boolean,\r\n  readonly: Boolean\r\n}\r\n\r\nexport const coreEmits = [\r\n  ...useFileEmits,\r\n  'start', 'finish', 'added', 'removed'\r\n]\r\n\r\nexport function getRenderer (getPlugin) {\r\n  const vm = getCurrentInstance()\r\n  const { props, slots, emit, proxy } = vm\r\n  const { $q } = proxy\r\n\r\n  const isDark = useDark(props, $q)\r\n\r\n  function updateFileStatus (file, status, uploadedSize) {\r\n    file.__status = status\r\n\r\n    if (status === 'idle') {\r\n      file.__uploaded = 0\r\n      file.__progress = 0\r\n      file.__sizeLabel = humanStorageSize(file.size)\r\n      file.__progressLabel = '0.00%'\r\n      return\r\n    }\r\n    if (status === 'failed') {\r\n      proxy.$forceUpdate()\r\n      return\r\n    }\r\n\r\n    file.__uploaded = status === 'uploaded'\r\n      ? file.size\r\n      : uploadedSize\r\n\r\n    file.__progress = status === 'uploaded'\r\n      ? 1\r\n      : Math.min(0.9999, file.__uploaded / file.size)\r\n\r\n    file.__progressLabel = getProgressLabel(file.__progress)\r\n    proxy.$forceUpdate()\r\n  }\r\n\r\n  const state = {\r\n    files: ref([]),\r\n    queuedFiles: ref([]),\r\n    uploadedFiles: ref([]),\r\n    uploadedSize: ref(0),\r\n\r\n    updateFileStatus,\r\n    isAlive () {\r\n      return vm.isDeactivated !== true && vm.isUnmounted !== true\r\n    }\r\n  }\r\n\r\n  Object.assign(state, getPlugin({ props, slots, emit, helpers: state }))\r\n\r\n  const uploadSize = ref(0)\r\n  const editable = computed(() => props.disable !== true && props.readonly !== true)\r\n\r\n  if (state.isBusy === void 0) {\r\n    state.isBusy = ref(false)\r\n  }\r\n\r\n  const dnd = ref(false)\r\n\r\n  const rootRef = ref(null)\r\n  const inputRef = ref(null)\r\n\r\n  provide(uploaderKey, renderInput)\r\n\r\n  const {\r\n    pickFiles,\r\n    addFiles,\r\n    onDragover,\r\n    onDragleave,\r\n    processFiles,\r\n    getDndNode,\r\n    maxFilesNumber,\r\n    maxTotalSizeNumber\r\n  } = useFile({ editable, dnd, getFileInput, addFilesToQueue })\r\n\r\n  const canAddFiles = computed(() =>\r\n    editable.value === true\r\n    && state.isUploading.value !== true\r\n    // if single selection and no files are queued:\r\n    && (props.multiple === true || state.queuedFiles.value.length === 0)\r\n    // if max-files is set and current number of files does not exceeds it:\r\n    && (props.maxFiles === void 0 || state.files.value.length < maxFilesNumber.value)\r\n    // if max-total-size is set and current upload size does not exceeds it:\r\n    && (props.maxTotalSize === void 0 || uploadSize.value < maxTotalSizeNumber.value)\r\n  )\r\n\r\n  const canUpload = computed(() =>\r\n    editable.value === true\r\n    && state.isBusy.value !== true\r\n    && state.isUploading.value !== true\r\n    && state.queuedFiles.value.length > 0\r\n  )\r\n\r\n  const uploadProgress = computed(() => (\r\n    uploadSize.value === 0\r\n      ? 0\r\n      : state.uploadedSize.value / uploadSize.value\r\n  ))\r\n\r\n  const uploadProgressLabel = computed(() => getProgressLabel(uploadProgress.value))\r\n  const uploadSizeLabel = computed(() => humanStorageSize(uploadSize.value))\r\n\r\n  const classes = computed(() =>\r\n    'q-uploader column no-wrap'\r\n    + (isDark.value === true ? ' q-uploader--dark q-dark' : '')\r\n    + (props.bordered === true ? ' q-uploader--bordered' : '')\r\n    + (props.square === true ? ' q-uploader--square no-border-radius' : '')\r\n    + (props.flat === true ? ' q-uploader--flat no-shadow' : '')\r\n    + (props.disable === true ? ' disabled q-uploader--disable' : '')\r\n  )\r\n\r\n  const colorClass = computed(() =>\r\n    'q-uploader__header'\r\n    + (props.color !== void 0 ? ` bg-${ props.color }` : '')\r\n    + (props.textColor !== void 0 ? ` text-${ props.textColor }` : '')\r\n  )\r\n\r\n  watch(state.isUploading, (newVal, oldVal) => {\r\n    if (oldVal === false && newVal === true) {\r\n      emit('start')\r\n    }\r\n    else if (oldVal === true && newVal === false) {\r\n      emit('finish')\r\n    }\r\n  })\r\n\r\n  function reset () {\r\n    if (props.disable === false) {\r\n      state.abort()\r\n      state.uploadedSize.value = 0\r\n      uploadSize.value = 0\r\n      revokeImgURLs()\r\n      state.files.value = []\r\n      state.queuedFiles.value = []\r\n      state.uploadedFiles.value = []\r\n    }\r\n  }\r\n\r\n  function removeUploadedFiles () {\r\n    if (props.disable === false) {\r\n      batchRemoveFiles([ 'uploaded' ], () => {\r\n        state.uploadedFiles.value = []\r\n      })\r\n    }\r\n  }\r\n\r\n  function removeQueuedFiles () {\r\n    batchRemoveFiles([ 'idle', 'failed' ], ({ size }) => {\r\n      uploadSize.value -= size\r\n      state.queuedFiles.value = []\r\n    })\r\n  }\r\n\r\n  function batchRemoveFiles (statusList, cb) {\r\n    if (props.disable === true) {\r\n      return\r\n    }\r\n\r\n    const removed = {\r\n      files: [],\r\n      size: 0\r\n    }\r\n\r\n    const localFiles = state.files.value.filter(f => {\r\n      if (statusList.indexOf(f.__status) === -1) {\r\n        return true\r\n      }\r\n\r\n      removed.size += f.size\r\n      removed.files.push(f)\r\n\r\n      f.__img !== void 0 && window.URL.revokeObjectURL(f.__img.src)\r\n\r\n      return false\r\n    })\r\n\r\n    if (removed.files.length > 0) {\r\n      state.files.value = localFiles\r\n      cb(removed)\r\n      emit('removed', removed.files)\r\n    }\r\n  }\r\n\r\n  function removeFile (file) {\r\n    if (props.disable) { return }\r\n\r\n    if (file.__status === 'uploaded') {\r\n      state.uploadedFiles.value = state.uploadedFiles.value.filter(f => f.__key !== file.__key)\r\n    }\r\n    else if (file.__status === 'uploading') {\r\n      file.__abort()\r\n    }\r\n    else {\r\n      uploadSize.value -= file.size\r\n    }\r\n\r\n    state.files.value = state.files.value.filter(f => {\r\n      if (f.__key !== file.__key) {\r\n        return true\r\n      }\r\n\r\n      f.__img !== void 0 && window.URL.revokeObjectURL(f.__img.src)\r\n\r\n      return false\r\n    })\r\n\r\n    state.queuedFiles.value = state.queuedFiles.value.filter(f => f.__key !== file.__key)\r\n    emit('removed', [ file ])\r\n  }\r\n\r\n  function revokeImgURLs () {\r\n    state.files.value.forEach(f => {\r\n      f.__img !== void 0 && window.URL.revokeObjectURL(f.__img.src)\r\n    })\r\n  }\r\n\r\n  function getFileInput () {\r\n    return inputRef.value\r\n      || rootRef.value.getElementsByClassName('q-uploader__input')[ 0 ]\r\n  }\r\n\r\n  function addFilesToQueue (e, fileList) {\r\n    const localFiles = processFiles(e, fileList, state.files.value, true)\r\n\r\n    if (localFiles === void 0) { return }\r\n\r\n    const fileInput = getFileInput()\r\n    if (fileInput !== void 0 && fileInput !== null) {\r\n      fileInput.value = ''\r\n    }\r\n\r\n    localFiles.forEach(file => {\r\n      state.updateFileStatus(file, 'idle')\r\n      uploadSize.value += file.size\r\n\r\n      if (props.noThumbnails !== true && file.type.toUpperCase().startsWith('IMAGE')) {\r\n        const img = new Image()\r\n        img.src = window.URL.createObjectURL(file)\r\n        file.__img = img\r\n      }\r\n    })\r\n\r\n    state.files.value = state.files.value.concat(localFiles)\r\n    state.queuedFiles.value = state.queuedFiles.value.concat(localFiles)\r\n    emit('added', localFiles)\r\n    props.autoUpload === true && state.upload()\r\n  }\r\n\r\n  function upload () {\r\n    canUpload.value === true && state.upload()\r\n  }\r\n\r\n  function getBtn (show, icon, fn) {\r\n    if (show === true) {\r\n      const data = {\r\n        type: 'a',\r\n        key: icon,\r\n        icon: $q.iconSet.uploader[ icon ],\r\n        flat: true,\r\n        dense: true\r\n      }\r\n\r\n      let child = void 0\r\n\r\n      if (icon === 'add') {\r\n        data.onClick = pickFiles\r\n        child = renderInput\r\n      }\r\n      else {\r\n        data.onClick = fn\r\n      }\r\n\r\n      return h(QBtn, data, child)\r\n    }\r\n  }\r\n\r\n  function renderInput () {\r\n    return h('input', {\r\n      ref: inputRef,\r\n      class: 'q-uploader__input overflow-hidden absolute-full',\r\n      tabindex: -1,\r\n      type: 'file',\r\n      title: '', // try to remove default tooltip\r\n      accept: props.accept,\r\n      multiple: props.multiple === true ? 'multiple' : void 0,\r\n      capture: props.capture,\r\n      onMousedown: stop, // need to stop refocus from QBtn\r\n      onClick: pickFiles,\r\n      onChange: addFilesToQueue\r\n    })\r\n  }\r\n\r\n  function getHeader () {\r\n    if (slots.header !== void 0) {\r\n      return slots.header(slotScope.value)\r\n    }\r\n\r\n    return [\r\n      h('div', {\r\n        class: 'q-uploader__header-content column'\r\n      }, [\r\n        h('div', {\r\n          class: 'flex flex-center no-wrap q-gutter-xs'\r\n        }, [\r\n          getBtn(state.queuedFiles.value.length > 0, 'removeQueue', removeQueuedFiles),\r\n          getBtn(state.uploadedFiles.value.length > 0, 'removeUploaded', removeUploadedFiles),\r\n\r\n          state.isUploading.value === true\r\n            ? h(QSpinner, { class: 'q-uploader__spinner' })\r\n            : null,\r\n\r\n          h('div', { class: 'col column justify-center' }, [\r\n            props.label !== void 0\r\n              ? h('div', { class: 'q-uploader__title' }, [ props.label ])\r\n              : null,\r\n\r\n            h('div', { class: 'q-uploader__subtitle' }, [\r\n              uploadSizeLabel.value + ' / ' + uploadProgressLabel.value\r\n            ])\r\n          ]),\r\n\r\n          getBtn(canAddFiles.value, 'add'),\r\n          getBtn(props.hideUploadBtn === false && canUpload.value === true, 'upload', state.upload),\r\n          getBtn(state.isUploading.value, 'clear', state.abort)\r\n        ])\r\n      ])\r\n    ]\r\n  }\r\n\r\n  function getList () {\r\n    if (slots.list !== void 0) {\r\n      return slots.list(slotScope.value)\r\n    }\r\n\r\n    return state.files.value.map(file => h('div', {\r\n      key: file.__key,\r\n      class: 'q-uploader__file relative-position'\r\n        + (props.noThumbnails !== true && file.__img !== void 0 ? ' q-uploader__file--img' : '')\r\n        + (\r\n          file.__status === 'failed'\r\n            ? ' q-uploader__file--failed'\r\n            : (file.__status === 'uploaded' ? ' q-uploader__file--uploaded' : '')\r\n        ),\r\n      style: props.noThumbnails !== true && file.__img !== void 0\r\n        ? { backgroundImage: 'url(\"' + file.__img.src + '\")' }\r\n        : null\r\n    }, [\r\n      h('div', {\r\n        class: 'q-uploader__file-header row flex-center no-wrap'\r\n      }, [\r\n        file.__status === 'failed'\r\n          ? h(QIcon, {\r\n            class: 'q-uploader__file-status',\r\n            name: $q.iconSet.type.negative,\r\n            color: 'negative'\r\n          })\r\n          : null,\r\n\r\n        h('div', { class: 'q-uploader__file-header-content col' }, [\r\n          h('div', { class: 'q-uploader__title' }, [ file.name ]),\r\n          h('div', {\r\n            class: 'q-uploader__subtitle row items-center no-wrap'\r\n          }, [\r\n            file.__sizeLabel + ' / ' + file.__progressLabel\r\n          ])\r\n        ]),\r\n\r\n        file.__status === 'uploading'\r\n          ? h(QCircularProgress, {\r\n            value: file.__progress,\r\n            min: 0,\r\n            max: 1,\r\n            indeterminate: file.__progress === 0\r\n          })\r\n          : h(QBtn, {\r\n            round: true,\r\n            dense: true,\r\n            flat: true,\r\n            icon: $q.iconSet.uploader[ file.__status === 'uploaded' ? 'done' : 'clear' ],\r\n            onClick: () => { removeFile(file) }\r\n          })\r\n      ])\r\n    ]))\r\n  }\r\n\r\n  onBeforeUnmount(() => {\r\n    state.isUploading.value === true && state.abort()\r\n    state.files.value.length > 0 && revokeImgURLs()\r\n  })\r\n\r\n  const publicMethods = {\r\n    pickFiles,\r\n    addFiles,\r\n    reset,\r\n    removeUploadedFiles,\r\n    removeQueuedFiles,\r\n    removeFile,\r\n    upload,\r\n    abort: state.abort\r\n  }\r\n\r\n  // TODO: the result of this computed, especially the dynamic part, isn't currently typed\r\n  // This result in an error with Volar when accessing the state (eg. files array)\r\n  const slotScope = computed(() => {\r\n    const acc = {\r\n      canAddFiles: canAddFiles.value,\r\n      canUpload: canUpload.value,\r\n      uploadSizeLabel: uploadSizeLabel.value,\r\n      uploadProgressLabel: uploadProgressLabel.value\r\n    }\r\n\r\n    for (const key in state) {\r\n      acc[ key ] = isRef(state[ key ]) === true\r\n        ? state[ key ].value\r\n        : state[ key ]\r\n    }\r\n\r\n    // TODO: (Qv3) Put the QUploader instance under `ref`\r\n    // property for consistency and flexibility\r\n    // return { ref: { ...acc, ...publicMethods } }\r\n    return { ...acc, ...publicMethods }\r\n  })\r\n\r\n  // expose public methods\r\n  Object.assign(proxy, publicMethods)\r\n\r\n  return () => {\r\n    const children = [\r\n      h('div', { class: colorClass.value }, getHeader()),\r\n      h('div', { class: 'q-uploader__list scroll' }, getList()),\r\n      getDndNode('uploader')\r\n    ]\r\n\r\n    state.isBusy.value === true && children.push(\r\n      h('div', {\r\n        class: 'q-uploader__overlay absolute-full flex flex-center'\r\n      }, [ h(QSpinner) ])\r\n    )\r\n\r\n    const data = { ref: rootRef, class: classes.value }\r\n\r\n    if (canAddFiles.value === true) {\r\n      Object.assign(data, { onDragover, onDragleave })\r\n    }\r\n\r\n    return h('div', data, children)\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}